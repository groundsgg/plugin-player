version: v2beta1
name: plugin-player-velocity

deployments:
  app:
    namespace: games
    helm:
      releaseName: plugin-player-velocity
      chart:
        name: oci://ghcr.io/groundsgg/charts/agones-fleet
        version: 0.1.0
      values:
        image:
          repository: ghcr.io/groundsgg/velocity
          tag: 0.6.0
        serverType: velocity
        command: ["/bin/sh", "-c", "sleep infinity"]

dev:
  app:
    # Search for the container that runs this image
    imageSelector: ghcr.io/groundsgg/velocity
    # Synchronize the plugin jar file to the plugins directory
    sync:
      - path: ./build/libs/*.jar:/app/plugins/*.jar
        initialSync: preferLocal
        file: true
    # Open a terminal and use the following command to start it
    terminal:
      disableReplace: true
      command: |
        # ENV needs to be exported in start command because we are not letting devspace replace the pod
        export PLAYER_PRESENCE_GRPC_TARGET=dns:///service-player.api.svc.cluster.local:9000
        echo "Use ./start.sh to start the server"
        /bin/sh
    # Forward the following ports to be able to access your application via localhost
    ports:
      - port: "25565"
